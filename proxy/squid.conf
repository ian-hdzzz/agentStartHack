# Squid Proxy Configuration for CEA API Access
# Minimal config - only allows CEA domains

# Port
http_port 3128

# ACLs
acl localnet src 10.0.0.0/8
acl localnet src 172.16.0.0/12
acl localnet src 192.168.0.0/16
acl localhost src 127.0.0.1/32

acl SSL_ports port 443
acl Safe_ports port 80
acl Safe_ports port 443
acl CONNECT method CONNECT

# Only allow CEA domains (whitelist approach)
acl cea_domains dstdomain .ceaqueretaro.gob.mx
acl cea_domains dstdomain .aquacis.com

# Security: deny unsafe ports
http_access deny !Safe_ports
http_access deny CONNECT !SSL_ports

# Allow CEA domains from local networks
http_access allow localnet cea_domains
http_access allow localhost cea_domains

# Deny everything else
http_access deny all

# Privacy: don't leak internal info
forwarded_for off
request_header_access Via deny all
request_header_access X-Forwarded-For deny all
request_header_access Proxy-Connection deny all

# Performance
cache_mem 64 MB
maximum_object_size 10 MB
cache_dir ufs /var/spool/squid 100 16 256

# Logging (Docker will capture stdout)
access_log stdio:/var/log/squid/access.log
cache_log stdio:/var/log/squid/cache.log

# Timeouts
connect_timeout 30 seconds
read_timeout 30 seconds
request_timeout 30 seconds

# DNS
dns_nameservers 8.8.8.8 8.8.4.4
